[gd_scene load_steps=3 format=3 uid="uid://bw1k8b4hsm2uh"]

[ext_resource type="PackedScene" uid="uid://b04y8g6jsk7v3" path="res://Scenet/Player.tscn" id="2_ha7d5"]

[sub_resource type="GDScript" id="GDScript_yd5e7"]
script/source = "class_name Level extends Node2D

@export var player:player
@export var doors:Array[Door]
data = NewDataHandoff

func _ready() -> void:
	player.disable()
	player.visible = false
	
	if data == null:
		enter_level()


func enter_level() -> void:
	if data != null:
		init_player_location()
	player.enable()
	_connect_to_doors()
	
	
	
func init_player_location() -> void:
	if data != null:
		for door in doors:
			if door.name == data.entry_door_name:
				player.position = door.get_player_entry_vector()
		player.orient(data.move_dir)


func _on_player_entered_door(door:Door) -> void:
	_disconnect_from_doors()
	player.disable()
	player.queue_free()
	data = LevelDataHandoff.new()
	data.entry_door_name = door.entry_door_name
	data.move_dir = door.get_move_dir()
	set_process(false)
	
	
func _connect_to_doors() -> void:
	for door in doors:
		if not door.player_entered_door.is_connected(_on_player_entered_door):
			door.player_entered_door.disconnect(_on_player_entered_door)
"

[node name="Taverna" type="Node2D"]
script = SubResource("GDScript_yd5e7")

[node name="Player" parent="." instance=ExtResource("2_ha7d5")]
